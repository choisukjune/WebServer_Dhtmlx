<!DOCTYPE html>
<html>

<head>
	
    <!-- meta block -->
	<title>Initialization with config.data - DHTMLX Grid</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1.0" charset="utf-8">
	<!-- end meta block -->

	<script type="text/javascript" src="../common/js/grid.js?v=7.3.14"></script>
	<link rel="stylesheet" href="../common/css/grid.css?v=7.3.14">	
	<link rel="stylesheet" href="./common/css/index.css?v=7.3.14">

</head>

<body>

    <section class="" style="height: 100%; width:100%;">
		<div style="height: 100%; width: 100%" id="grid"></div>
	</section>
	<script>
        /*
        "수업시작일"
        "학교"
        "지역"
        "신청자"
        "연락처"
        "이메일"
        "1일차"
        "2일차"
        "3일차 - 구름출강강사X 학교 교사가 진행하시는 경우에만 해당함"
        "커리큘럼"
        "사전 출석부 링크"
        "신청인원"
        "참여인원"
        "간식 주소지"
        "주교사"
        "보조교사"
        "주강사 매칭"
        "보조강사 매칭"
        "채널링크"
        "마켓확인"
        "확정메일"
        "문자"
        "강사 강의자 지정"
        ""
        ""
        "보험
        "간식
        "안전요원"
        "주강사 강사료 지급"
        "보조강사 강사료 지급"
        "굿즈 발송여부"
        "수료증 발송여부"
        "에듀_진원"
        "교사 사전 메일 발송(2주전)"
        "강사 사전메일 발송(2주전)"
        "D -10 날짜"
        "사전환경조사 (D-10)"
        "에듀_태현"
        "사전 출석부"
        "학생용 사전 설문지 (1일차 당일)"
        "학생용 온라인 출석부 1일차"
        "학생용 온라인 출석부 2일차"
        "체크리스트(1일차 당일)"
        "체크리스트(2일차 당일)"
        "체크리스트 PDF"
        "수업사진(1일차 당일)"
        "수업사진 (2일차 당일)"
        "학습 결과물 (수업 종료일)"
        "학습 성취도 (수업 종료일)"
        "CSV (수업 종료일)"
        "학생용 만족도 조사"
        "교사용 사후 설문지"
        "에듀_소이"
        "안전관리"
        "서약서"
        "체크리스트(1일차)"
        "체크리스트(2일차)"
        "사진 촬영 및 업로드"
        "프로그램 사전 계획표"
        "결과보고서 작성 (1일차)"
        "결과보고서 작성 (2일차)"
        "프로그램참여자 리스트"
        "결과보고서 및 사후활동"
        "우수학생 선발"
        "캠프 자체 평가(1~5점)"
        "사후활동 여부"
        "안전관리 운영 후 체크리스트"
        "강사비 지급(오프라인)"
        "강사비 지급(사후)"

    */
        window.CONFIG = {};

        window.CONFIG.APIServer = {};
        window.CONFIG.APIServer.HOST = "http://localhost";
        window.CONFIG.APIServer.PORT = 8888;

        window.CONFIG.URLS = {};
        window.CONFIG.URLS.getListAllCamp = "https://webhooks.mongodb-realm.com/api/client/v2.0/app/data-xiypp/service/campSheet/incoming_webhook/webhook0?secret=123qweasdzxc"//window.CONFIG.APIServer.HOST + ":" + window.CONFIG.APIServer.PORT + "/findAll";
        window.CONFIG.URLS.updateData = window.CONFIG.APIServer.HOST + ":" + window.CONFIG.APIServer.PORT + "/update";


        var reqPost = function( url, data, cbFcuntion ){
            var xhr = new XMLHttpRequest();
            xhr.onload = function() {
                if (xhr.status === 200 || xhr.status === 201) {
                    //console.log(xhr.responseText);
                    var r = xhr.responseText;
                    cbFcuntion( r );
                } else {
                    console.error(xhr.responseText);
                }
            };
            xhr.open('POST', url);
            //xhr.setRequestHeader('Content-Type', 'application/json'); // 컨텐츠타입을 json으로
            xhr.send(JSON.stringify(data));
        }


        var reqGet = function( url, cbFcuntion ){
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function(){
                if (xhr.readyState === xhr.DONE) {
                    if (xhr.status === 200 || xhr.status === 201) {
                        var r = xhr.responseText;
                        cbFcuntion(r)
                    } else {
                        console.error(xhr.responseText);
                    }
                }
            };
            
            xhr.open('GET', url );
            
            xhr.setRequestHeader("apiKey", "J5q3a5GgOO9P883SDuarc7NhucyuoK8d30bnzILpq9xsXjXTydO8ICJ3RWblTGYO");
            xhr.setRequestHeader("Content-Type", "application/json");

            
            xhr.send();

/*
            curl -X GET \
   -H 'apiKey: J5q3a5GgOO9P883SDuarc7NhucyuoK8d30bnzILpq9xsXjXTydO8ICJ3RWblTGYO' \
   -H 'Content-Type: application/json' \
   https://data.mongodb-api.com/app/data-xiypp/endpoint/camp

            xhr.setRequestHeader("apiKey", "J5q3a5GgOO9P883SDuarc7NhucyuoK8d30bnzILpq9xsXjXTydO8ICJ3RWblTGYO");
            xhr.setRequestHeader("Content-Type", "application/json");
*/
        }

        var getListAllCamp = function( url ){
            reqGet( url, function(d){

                var dataset = JSON.parse(d)
                var i = 0,iLen = dataset.length,io;
                for(;i<iLen;++i){
                    io = dataset[ i ];
                    var d = new Date( io.A )
                    if( isNaN(d) ) d = ""
                    io.A = d;
                }		

                var grid = new dhx.Grid("grid", 
                    {   columns: [
                        { width: 150, id: "_id", header: [{ text: "cd" }] },
                        { width: 150, id: "A", header: [{ text: "수업시작일" }], type: "date", format: "%Y-%m-%d " },
                        { width: 150, id: "B", header: [{ text: "학교" }, { content: "comboFilter", filterConfig: { placeholder: "Type something", virtual: true }, }] },
                        { width: 150, id: "C", header: [{ text: "지역" }, { content: "comboFilter", filterConfig: { placeholder: "Type something", virtual: true }, }] },
                        { width: 150, id: "D", header: [{ text: "신청자" }, { content: "comboFilter", filterConfig: { placeholder: "Type something", virtual: true }, }] },
                        { width: 150, id: "E", header: [{ text: "연락처" }] },
                        { width: 150, id: "F", header: [{ text: "이메일" }] },
                        { width: 150, id: "G", header: [{ text: "1일차" }] },
                        { width: 150, id: "H", header: [{ text: "2일차" }] },
                        { width: 150, id: "I", header: [{ text: "3일차 - 구름출강강사X 학교 교사가 진행하시는 경우에만 해당함" }] },
                        { width: 150, id: "J", header: [{ text: "커리큘럼" }] },
                        { width: 150, id: "K", header: [{ text: "사전 출석부 링크" }],htmlEnable: true,
                            template: function (text, row, col) {
                                if( text.indexOf(",") != -1 )
                                {
                                    text.replace(",","</br>");
                                    
                                }
                                return text.replace(" ","</br>");
                            }
                        },
                        
                        { width: 150, id: "L", header: [{ text: "신청인원" }] },
                        { width: 150, id: "M", header: [{ text: "참여인원" }] },
                        { width: 150, id: "N", header: [{ text: "간식 주소지" }] },
                        { width: 150, id: "O", header: [{ text: "주교사" }] },
                        { width: 150, id: "P", header: [{ text: "보조교사" }] },
                        { width: 150, id: "Q", header: [{ text: "주강사 매칭" }] },
                        { width: 150, id: "R", header: [{ text: "보조강사 매칭" }] },
                        { width: 150, id: "S", header: [{ text: "채널링크" }] },
                        { width: 150, id: "T", header: [{ text: "마켓확인" }] },
                        { width: 150, id: "U", header: [{ text: "확정메일" }] },
                        { width: 150, id: "V", header: [{ text: "문자" }] },
                        { width: 150, id: "W", header: [{ text: "강사 강의자 지정" }] },
                        { width: 150, id: "X", header: [{ text: "" }] },
                        { width: 150, id: "Y", header: [{ text: "" }] },
                        { width: 150, id: "Z", header: [{ text: "보험" }] },
                        { width: 150, id: "AA", header: [{ text: "간식" }] },
                        { width: 150, id: "AB", header: [{ text: "안전요원" }] },
                        { width: 150, id: "AC", header: [{ text: "주강사 강사료 지급" }] },
                        { width: 150, id: "AD", header: [{ text: "보조강사 강사료 지급" }] },
                        { width: 150, id: "AE", header: [{ text: "굿즈 발송여부" }] },
                        { width: 150, id: "AF", header: [{ text: "수료증 발송여부" }] },
                        { width: 150, id: "AG", header: [{ text: "에듀_진원" }] },
                        { width: 150, id: "AH", header: [{ text: "교사 사전 메일 발송(2주전)" }] },
                        { width: 150, id: "AI", header: [{ text: "강사 사전메일 발송(2주전)" }] },
                        { width: 150, id: "AJ", header: [{ text: "D -10 날짜" }] },
                        { width: 150, id: "AK", header: [{ text: "사전환경조사 (D-10)" }] },
                        { width: 150, id: "AL", header: [{ text: "에듀_태현" }] },
                        { width: 150, id: "AM", header: [{ text: "사전 출석부" }] },
                        { width: 150, id: "AN", header: [{ text: "학생용 사전 설문지 (1일차 당일)" }] },
                        { width: 150, id: "AO", header: [{ text: "학생용 온라인 출석부 1일차" }] },
                        { width: 150, id: "AP", header: [{ text: "학생용 온라인 출석부 2일차" }] },
                        { width: 150, id: "AQ", header: [{ text: "체크리스트(1일차 당일)" }] },
                        { width: 150, id: "AR", header: [{ text: "체크리스트(2일차 당일)" }] },
                        { width: 150, id: "AS", header: [{ text: "체크리스트 PDF" }] },
                        { width: 150, id: "AT", header: [{ text: "수업사진(1일차 당일)" }] },
                        { width: 150, id: "AU", header: [{ text: "수업사진 (2일차 당일)" }] },
                        { width: 150, id: "AV", header: [{ text: "학습 결과물 (수업 종료일)" }] },
                        { width: 150, id: "AW", header: [{ text: "학습 성취도 (수업 종료일)" }] },
                        { width: 150, id: "AX", header: [{ text: "CSV (수업 종료일)" }] },
                        { width: 150, id: "AY", header: [{ text: "학생용 만족도 조사" }] },
                        { width: 150, id: "AZ", header: [{ text: "교사용 사후 설문지" }] },
                        { width: 150, id: "BA", header: [{ text: "에듀_소이" }] },
                        { width: 150, id: "BB", header: [{ text: "안전관리" }] },
                        { width: 150, id: "BC", header: [{ text: "서약서" }] },
                        { width: 150, id: "BD", header: [{ text: "체크리스트(1일차)" }] },
                        { width: 150, id: "BE", header: [{ text: "체크리스트(2일차)" }] },
                        { width: 150, id: "BF", header: [{ text: "사진 촬영 및 업로드" }] },
                        { width: 150, id: "BG", header: [{ text: "프로그램 사전 계획표" }] },
                        { width: 150, id: "BH", header: [{ text: "결과보고서 작성 (1일차)" }] },
                        { width: 150, id: "BI", header: [{ text: "결과보고서 작성 (2일차)" }] },
                        { width: 150, id: "BJ", header: [{ text: "프로그램참여자 리스트" }] },
                        { width: 150, id: "BK", header: [{ text: "결과보고서 및 사후활동" }] },
                        { width: 150, id: "BL", header: [{ text: "우수학생 선발" }] },
                        { width: 150, id: "BM", header: [{ text: "캠프 자체 평가(1~5점)" }] },
                        { width: 150, id: "BN", header: [{ text: "사후활동 여부" }] },
                        { width: 150, id: "BO", header: [{ text: "안전관리 운영 후 체크리스트" }] },
                        { width: 150, id: "BP", header: [{ text: "강사비 지급(오프라인)" }] },
                        { width: 150, id: "BQ", header: [{ text: "강사비 지급(사후)" }] },

                        ],
                        data: dataset,
                        autoWidth: true,
                        adjust: true,
                        autoHeight: true,
                        //rowHeight: 20,
                        editable: true,
                        resizable: true,
                        leftSplit: 3
                    }
                );
                
                grid.events.on("afterEditEnd", function(value,row,column){
                    
                    var reqData = {};
                        reqData[ "_id" ] = row._id
                        reqData[ column.id ] = value
                        
                    reqPost(window.CONFIG.URLS.updateData, reqData, function(r){
                        console.log("update - OK!")
                    } )
                });
                        
                        
            })
        }

        window.addEventListener('DOMContentLoaded', function(){
            getListAllCamp( window.CONFIG.URLS.getListAllCamp )
        })
        
        		
	</script>
</body>

</html>